<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>ë§ˆì´í˜ì´ì§€ í†µê³„</title>

  <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" th:href="@{/css/fragment/header.css}" />
  <link rel="stylesheet" th:href="@{/css/fragment/sidenav.css}" />
  <link rel="stylesheet" th:href="@{/css/fragment/chatbot.css}" />
  <!-- í†µê³„ ì „ìš© ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" th:href="@{/css/user/stats.css}" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ -->
<div class="background-animation">
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>
  <div class="floating-shape"></div>
</div>

<!--ì•Œë¦¼ -->
<th:block th:replace="fragments/common/alert-script :: alert-script"></th:block>

<!-- í—¤ë” & ì‚¬ì´ë“œë°” -->
<header th:replace="fragments/header/header :: header"></header>
<aside th:replace="fragments/sidenav/user/user-sidenav :: sidebar"></aside>

<main>
  <div class="content-wrapper">
    <!-- ìƒë‹¨: ì˜¤ëŠ˜ì˜ í•™ìŠµ ìš”ì•½ (ì „ì²´ í­) -->
    <div class="card summary-card">
      <h3>âœ¨ ì˜¤ëŠ˜ì˜ í•™ìŠµ ìš”ì•½</h3>
      <div class="summary-box">
        <!-- âœ… ìˆ˜ì •: ì˜¤ëŠ˜ì˜ ë£¨í‹´ ë°ì´í„° ì‚¬ìš© -->
        <p>âœ… ì™„ë£Œëœ ë£¨í‹´: <strong th:text="${todayCompletion.completedCount}">0</strong>ê°œ /
          ë‚¨ì€ ë£¨í‹´: <strong th:text="${todayCompletion.totalCount - todayCompletion.completedCount}">0</strong>ê°œ</p>
        <!-- âœ… ìˆ˜ì •: ì˜¤ëŠ˜ì˜ í•™ìŠµ ì‹œê°„ ì‚¬ìš© -->
        <p>â±ï¸ ì˜¤ëŠ˜ì˜ í•™ìŠµ ì‹œê°„: <strong th:text="${todayActualFocusTime}">0</strong>ë¶„</p>
        <!-- âœ… ì¶”ê°€: ì˜¤ëŠ˜ì˜ ì™„ë£Œìœ¨ í‘œì‹œ (ì„ íƒì‚¬í•­) -->
        <p th:if="${todayCompletion.totalCount > 0}">
          ğŸ“Š ì˜¤ëŠ˜ì˜ ì™„ë£Œìœ¨: <strong th:text="${#numbers.formatDecimal(todayCompletion.completionRate, 1, 1)} + '%'">0.0%</strong>
        </p>
        <p th:if="${todayCompletion.totalCount == 0}" style="color: rgba(255, 255, 255, 0.7);">
          ğŸ“­ ì˜¤ëŠ˜ ë“±ë¡ëœ ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤.
        </p>
      </div>
    </div>

    <!-- ì¤‘ê°„ ì™¼ìª½: í•™ìŠµ ì‹œê°„ ê·¸ë˜í”„ -->
    <div class="card chart-card">
      <h2>ğŸ“ˆ í•™ìŠµ ì‹œê°„ ê·¸ë˜í”„</h2>
      <div class="chart-container">
        <canvas id="focusChart" width="400" height="300"></canvas>
      </div>
    </div>

    <!-- ì¤‘ê°„ ì˜¤ë¥¸ìª½: ì˜¤ëŠ˜ì˜ ì¼ì • -->
    <div class="card schedule-card">
      <h3>ğŸ“… ì˜¤ëŠ˜ì˜ ì¼ì •</h3>
      <div class="summary-box">
        <div th:if="${todayTodos.size() == 0}" class="empty-state">
          <p>ğŸ“­ ì˜¤ëŠ˜ ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
        <ul th:if="${todayTodos.size() > 0}">
          <li th:each="todo : ${todayTodos}">
            ğŸ—“ï¸ <strong th:text="${#temporals.format(todo.startTime, 'HH:mm')}">ì‹œê°„</strong> -
            <span th:text="${todo.title}">í•  ì¼ ì œëª©</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- í•˜ë‹¨: ì¹´í…Œê³ ë¦¬ë³„ ì™„ë£Œ í†µê³„ (ì „ì²´ í­) -->
    <div class="card category-card">
      <h3>ğŸ“š ì¹´í…Œê³ ë¦¬ë³„ ì™„ë£Œ í†µê³„</h3>
      <div class="summary-box">
        <table>
          <thead>
          <tr>
            <th>ì¹´í…Œê³ ë¦¬</th>
            <th>ì™„ë£Œ</th>
            <th>ì „ì²´</th>
            <th>ì™„ë£Œìœ¨</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="stat : ${categoryStats}">
            <td th:text="${stat.category}">ì¹´í…Œê³ ë¦¬</td>
            <td th:text="${stat.completedCount}">0</td>
            <td th:text="${stat.totalCount}">0</td>
            <td><strong th:text="${#numbers.formatDecimal(stat.completionRate, 1, 1)} + '%'">0.0%</strong></td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>

<!-- ì±—ë´‡ -->
<th:block th:replace="fragments/common/chatbot-modal :: chatbot"></th:block>

<script th:inline="javascript">
  // ì°¨íŠ¸ ë°ì´í„°
  const labels = /*[[${focusTimes.keySet()}]]*/ [];
  const values = /*[[${focusTimes.values()}]]*/ [];

  // ì°¨íŠ¸ ìƒì„±
  const ctx = document.getElementById('focusChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'ì§‘ì¤‘ ì‹œê°„ (ë¶„)',
        data: values,
        backgroundColor: 'rgba(102, 126, 234, 0.8)',
        borderColor: 'rgba(102, 126, 234, 1)',
        borderWidth: 2,
        borderRadius: 8,
        borderSkipped: false,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: 'rgba(255, 255, 255, 0.9)',
            font: {
              size: 14,
              weight: 'bold'
            }
          }
        }
      },
      scales: {
        x: {
          ticks: {
            color: 'rgba(255, 255, 255, 0.8)',
            font: {
              size: 12,
              weight: '500'
            }
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          }
        },
        y: {
          beginAtZero: true,
          ticks: {
            color: 'rgba(255, 255, 255, 0.8)',
            font: {
              size: 12,
              weight: '500'
            }
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          }
        }
      }
    }
  });
</script>
</body>
</html>