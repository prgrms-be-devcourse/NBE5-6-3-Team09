<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="_csrf" th:content="${_csrf?.token}" />
  <meta name="_csrf_header" th:content="${_csrf?.headerName}" />
  <title>ë°ì¼ë¦¬ ë£¨í‹´</title>

  <!-- âœ… ê³µí†µ ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" th:href="@{/css/fragment/header.css}"/>
  <link rel="stylesheet" th:href="@{/css/fragment/sidenav.css}"/>
  <link rel="stylesheet" th:href="@{/css/fragment/chatbot.css}"/>

  <style>
    /* ===== ì™„ì „íˆ ìˆ˜ì •ëœ ë£¨í‹´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ ===== */

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ - ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼ */
    .background-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .floating-shape {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: float 20s infinite;
    }

    .floating-shape:nth-child(1) {
      width: 80px;
      height: 80px;
      top: 20%;
      left: 20%;
      animation-delay: 0s;
    }

    .floating-shape:nth-child(2) {
      width: 120px;
      height: 120px;
      top: 60%;
      right: 20%;
      animation-delay: -7s;
    }

    .floating-shape:nth-child(3) {
      width: 60px;
      height: 60px;
      bottom: 30%;
      left: 60%;
      animation-delay: -14s;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px) rotate(0deg);
        opacity: 0.7;
      }
      33% {
        transform: translateY(-30px) rotate(120deg);
        opacity: 0.9;
      }
      66% {
        transform: translateY(30px) rotate(240deg);
        opacity: 0.5;
      }
    }

    /* íˆìŠ¤í† ë¦¬ íšŒê³  ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .routine-btn.history-review {
      background-color: #8b5cf6;
      color: white;
    }

    .routine-btn.history-review:hover {
      background-color: #7c3aed;
      transform: translateY(-1px);
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }

    .nav-item:hover {
      background-color: #f3f4f6;
      transform: translateX(4px);
    }

    .nav-item.active {
      background-color: #f0f4ff;
      color: #667eea;
      font-weight: 600;
    }

    .nav-item.active .nav-indicator {
      opacity: 1;
    }

    main {
      margin-left: 280px !important;
      margin-top: 0 !important;
      padding: 30px !important;
      min-height: calc(100vh - 70px) !important;
      transition: margin-left 0.3s ease;
      position: relative;
      z-index: 1;
      overflow: visible !important;
    }

    .routine-wrapper {
      background: rgba(255, 255, 255, 0.95) !important;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 30px;
      border-radius: 20px;
      max-width: 1200px !important;
      width: 100%;
      margin: 0 auto;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1), 0 10px 20px rgba(0, 0, 0, 0.05);
      position: relative;
      z-index: 2;
      overflow: visible !important;
    }

    /* âœ… ë£¨í‹´ í—¤ë” ìˆ˜ì • */
    .routine-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(102, 126, 234, 0.1);
      overflow: visible !important; /* âœ… overflow visible ì¶”ê°€ */
      min-height: 50px; /* âœ… ìµœì†Œ ë†’ì´ ì„¤ì • */
    }

    .routine-header h2 {
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0; /* âœ… ì œëª©ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
    }

    /*.history-indicator {
      background: linear-gradient(135deg, #667eea, #764ba2);;
      color: white;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 0.85rem;
      font-weight: 500;
    }*/

    /* âœ… ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ ìˆ˜ì • */
    .date-navigation {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0; /* âœ… ë²„íŠ¼ë“¤ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
      flex-wrap: wrap; /* âœ… í•„ìš”ì‹œ ì¤„ë°”ê¿ˆ í—ˆìš© */
    }

    .nav-btn {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
      white-space: nowrap; /* âœ… í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
      min-width: fit-content; /* âœ… ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
    }

    .nav-btn:hover {
      background: linear-gradient(135deg, #45a049, #4CAF50);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    }

    .date-filter {
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      overflow: visible; /* âœ… overflow visible ì¶”ê°€ */
    }

    .date-filter label {
      font-size: 14px;
      font-weight: 500;
      color: #4b5563;
      margin-right: 12px;
    }

    .date-filter input[type="date"] {
      padding: 8px 16px;
      border: 2px solid rgba(229, 231, 235, 0.5);
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
    }

    .date-filter input[type="date"]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* íˆìŠ¤í† ë¦¬ í†µê³„ */
    .history-stats {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 24px;
      border: 1px solid rgba(102, 126, 234, 0.2);
    }

    .history-stats h4 {
      margin-bottom: 12px;
      color: #374151;
      font-size: 16px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
      text-align: center;
      background: rgba(255, 255, 255, 0.6);
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .stat-label {
      font-size: 1rem;
      color: #666;
      font-weight: 500;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* ê³ ì • ë£¨í‹´ ì„¹ì…˜ */
    .fixed-routines-section {
      margin-bottom: 32px;
      overflow: visible; /* âœ… overflow visible ì¶”ê°€ */
    }

    .fixed-routines-section h3 {
      font-size: 20px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 16px;
    }

    .fixed-routines-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 16px;
    }

    .fixed-routine-card {
      background: linear-gradient(135deg, rgba(240, 244, 255, 0.8), rgba(224, 231, 255, 0.8));
      backdrop-filter: blur(10px);
      border: 2px solid rgba(199, 210, 254, 0.5);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }

    .fixed-routine-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 30px rgba(102, 126, 234, 0.2);
      border-color: rgba(102, 126, 234, 0.8);
    }

    .fixed-routine-info {
      flex: 1;
    }

    .fixed-routine-title {
      font-size: 16px;
      font-weight: 600;
      color: #4b5563;
      margin-bottom: 4px;
    }

    .fixed-routine-description {
      font-size: 14px;
      color: #6b7280;
    }

    .fixed-routine-start-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .fixed-routine-start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .all-routines-section {
      margin-bottom: 32px;
      overflow: visible !important;
    }

    /* âœ… ì„¹ì…˜ í—¤ë” ìˆ˜ì • */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      overflow: visible !important; /* âœ… overflow visible ì¶”ê°€ */
      min-height: 40px; /* âœ… ìµœì†Œ ë†’ì´ ì„¤ì • */
      gap: 16px; /* âœ… ìš”ì†Œ ê°„ ê°„ê²© ì¶”ê°€ */
    }

    .section-header h3 {
      font-size: 20px;
      font-weight: 600;
      color: #374151;
      margin: 0;
      flex-shrink: 0; /* âœ… ì œëª©ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
    }

    /* âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
    .add-routine-btn {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 4px;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
      white-space: nowrap; /* âœ… í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
      flex-shrink: 0; /* âœ… ë²„íŠ¼ì´ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ */
      min-width: fit-content; /* âœ… ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
    }

    .add-routine-btn:hover {
      background: linear-gradient(135deg, #059669, #10b981);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    /* âœ… ë£¨í‹´ ì•„ì´í…œ ìˆ˜ì • */
    .routine-item {
      background: rgba(249, 250, 251, 0.8);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(229, 231, 235, 0.5);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      position: relative; /* âœ… relative í¬ì§€ì…˜ ì¶”ê°€ */
      overflow: visible; /* âœ… overflow visible ì¶”ê°€ */
    }

    .routine-item:hover {
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
      z-index: 10; /* âœ… í˜¸ë²„ ì‹œ z-index ì¡°ì • */
    }

    /* ì™„ë£Œëœ ë£¨í‹´ ìŠ¤íƒ€ì¼ */
    .routine-item.completed .routine-title {
      text-decoration: line-through;
      color: #6b7280;
    }

    .routine-info {
      flex: 1;
    }

    .routine-title {
      font-size: 16px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 4px;
    }

    .routine-category {
      font-size: 14px;
      color: #6b7280;
    }

    /* âœ… ë£¨í‹´ ìš°ì¸¡ ì˜ì—­ ìˆ˜ì • */
    .routine-right {
      display: flex;
      align-items: center;
      gap: 8px;
      position: relative;
    }

    /* âœ… ë©”ë‰´ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ëª…ì‹œì  ìŠ¤íƒ€ì¼ */
    .routine-right > div {
      position: relative !important;
      z-index: 50; /* âœ… ë©”ë‰´ ì»¨í…Œì´ë„ˆ z-index */
    }

    /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ í†µí•© */
    .routine-btn {
      border: none;
      padding: 8px 16px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 80px;
    }

    /* ì‹œì‘í•˜ê¸° ë²„íŠ¼ */
    .routine-btn.start {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .routine-btn.start:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    /* ì™„ë£Œ ë²„íŠ¼ */
    .routine-btn.completed {
      background: linear-gradient(135deg, #9ca3af, #6b7280);
      color: white;
    }

    /* ì‰¬ì–´ê°€ê¸° ë²„íŠ¼ */
    .routine-btn.passed {
      background: linear-gradient(135deg, #d1d5db, #9ca3af);
      color: white;
    }

    .menu-button {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(229, 231, 235, 0.5);
      font-size: 20px;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 8px;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      color: #6b7280;
    }

    .menu-button:hover {
      background: rgba(243, 244, 246, 0.9);
      transform: translateY(-1px);
    }

    .menu-box {
      position: absolute;
      right: 0;
      top: 100%;
      background: white;
      border: 1px solid rgba(229, 231, 235, 0.5);
      border-radius: 8px;
      display: none;
      z-index: 1000 !important; /* âœ… z-indexë¥¼ 1000ìœ¼ë¡œ ì„¤ì • */
      min-width: 120px;
      overflow: hidden;
      /* âœ… ë‹¨ìˆœí™”ëœ ê·¸ë¦¼ì íš¨ê³¼ */
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1),
      0 2px 8px rgba(0, 0, 0, 0.08);
      /* âœ… ë‹¨ìˆœí™”ëœ ì• ë‹ˆë©”ì´ì…˜ */
      opacity: 0;
      transform: translateY(-5px);
      transition: all 0.15s ease;
    }

    .menu-box.show {
      opacity: 1;
      transform: translateY(0);
    }

    .menu-box div {
      padding: 10px 16px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      color: #374151;
      font-weight: 500;
      border-bottom: 1px solid rgba(229, 231, 235, 0.3);
    }

    .menu-box div:last-child {
      border-bottom: none;
    }

    .menu-box div:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
    }

    .menu-box div:first-child {
      border-radius: 12px 12px 0 0;
    }

    .menu-box div:last-child {
      border-radius: 0 0 12px 12px;
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: #6b7280;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }

    .empty-state p {
      margin-bottom: 12px;
      font-size: 16px;
    }

    /* íˆìŠ¤í† ë¦¬ ë·°ì—ì„œëŠ” ë²„íŠ¼ë“¤ ìˆ¨ê¸°ê¸° */
    .history-view .add-routine-btn {
      display: none;
    }

    .history-view .fixed-routines-section {
      display: none;
    }

    .history-view .menu-box {
      display: none !important;
    }

    .history-view .routine-btn:not(.history-review) {
      display: none;
    }

    /* âœ… ëª¨ë‹¬ z-index ì¡°ì • */
    .modal-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      z-index: 9998; /* âœ… ë©”ë‰´ë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
    }

    #routineModal, #codingTestModal, #interviewModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 32px;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      z-index: 9999; /* âœ… ë©”ë‰´ë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    #routineModal h3, #codingTestModal h3, #interviewModal h3 {
      font-size: 24px;
      font-weight: 600;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 24px;
    }

    #routineModal input, #routineModal select, #routineModal textarea,
    #codingTestModal input, #codingTestModal select, #codingTestModal textarea,
    #interviewModal input, #interviewModal select, #interviewModal textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 16px;
      border: 2px solid rgba(229, 231, 235, 0.5);
      border-radius: 10px;
      font-size: 14px;
      font-family: "Pretendard", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
    }

    #routineModal input:focus, #routineModal select:focus, #routineModal textarea:focus,
    #codingTestModal input:focus, #codingTestModal select:focus, #codingTestModal textarea:focus,
    #interviewModal input:focus, #interviewModal select:focus, #interviewModal textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    #routineModal textarea, #codingTestModal textarea, #interviewModal textarea {
      min-height: 100px;
      resize: vertical;
    }

    .button-group {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }

    .button-group button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .button-group button.cancel {
      background: rgba(229, 231, 235, 0.8);
      color: #4b5563;
      backdrop-filter: blur(10px);
    }

    .button-group button.cancel:hover {
      background: rgba(209, 213, 219, 0.9);
      transform: translateY(-1px);
    }

    .button-group button.submit {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .button-group button.submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    /* âœ… ë°˜ì‘í˜• ë””ìì¸ ê°œì„  */
    @media (max-width: 1024px) {
      main {
        margin-left: 0 !important;
        padding: 20px !important;
      }

      .routine-wrapper {
        max-width: 100% !important;
        padding: 20px;
      }

      .fixed-routines-container {
        grid-template-columns: 1fr;
      }

      .date-navigation {
        flex-wrap: wrap;
        gap: 4px;
        justify-content: center;
      }

      .nav-btn {
        padding: 6px 10px;
        font-size: 0.8rem;
      }
    }

    @media (max-width: 768px) {
      .routine-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }

      .date-navigation {
        width: 100%;
        justify-content: center;
      }

      /* âœ… ì„¹ì…˜ í—¤ë” ëª¨ë°”ì¼ ëŒ€ì‘ */
      .section-header {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .section-header h3 {
        text-align: center;
      }

      .add-routine-btn {
        width: 100%;
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      /* âœ… ë£¨í‹´ ì•„ì´í…œ ëª¨ë°”ì¼ ëŒ€ì‘ */
      .routine-item {
        background: rgba(249, 250, 251, 0.8);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(229, 231, 235, 0.5);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        position: relative;
        overflow: visible;
      }

      .routine-right {
        justify-content: space-between;
        width: 100%;
      }

      /* âœ… ëª¨ë°”ì¼ì—ì„œ ë©”ë‰´ ë“œë¡­ë‹¤ìš´ ìœ„ì¹˜ ì¡°ì • */
      .menu-box {
        right: 0;
        left: auto;
        min-width: 140px;
      }
    }
  </style>
</head>
<body th:class="${isHistoryView} ? 'history-view' : ''">
<!--ì•Œë¦¼ -->
<th:block th:replace="fragments/common/alert-script :: alert-script"></th:block>

<!-- í—¤ë” -->
<header th:replace="fragments/header/header :: header"></header>

<!-- ì‚¬ì´ë“œë°” -->
<aside th:replace="fragments/sidenav/user/user-sidenav :: sidebar"></aside>

<div th:replace="fragments/common/dropdown-script :: dropdown-script"></div>

<!-- ë©”ì¸ ì»¨í…ì¸  -->
<main>
  <div class="routine-wrapper">
    <div class="routine-header">
      <h2>
        ë°ì¼ë¦¬ ë£¨í‹´

      </h2>

      <!-- ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ -->
      <div class="date-navigation">
        <a th:href="@{/routines(date=${selectedDate.minusDays(1)})}" class="nav-btn">â—€ ì´ì „</a>
        <a th:href="@{/routines}" class="nav-btn" th:if="${!selectedDate.equals(today)}">ì˜¤ëŠ˜</a>
        <a th:href="@{/routines(date=${selectedDate.plusDays(1)})}"
           class="nav-btn"
           th:unless="${selectedDate.equals(today)}">ë‹¤ìŒ â–¶</a>
      </div>
    </div>

    <div class="date-filter">
      <form id="dateFilterForm" action="/routines" method="get">
        <label for="dateFilter">ë‚ ì§œ ì„ íƒ : </label>
        <input type="date" id="dateFilter" name="date"
               th:value="${#temporals.format(selectedDate, 'yyyy-MM-dd')}"
               onchange="this.form.submit()">
      </form>
    </div>

    <!-- íˆìŠ¤í† ë¦¬ í†µê³„ (íˆìŠ¤í† ë¦¬ ë·°ì¼ ë•Œë§Œ í‘œì‹œ) -->
    <div th:if="${isHistoryView}" class="history-stats">
      <h4>ğŸ“Š [[${#temporals.format(selectedDate, 'yyyyë…„ MMì›” ddì¼')}]] ë£¨í‹´ ìš”ì•½</h4>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">ì™„ë£Œëœ ë£¨í‹´</span>
          <span class="stat-value" th:text="${completedHistories?.size() ?: 0} + 'ê°œ'">0ê°œ</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ì§„í–‰ì¤‘ì´ì—ˆë˜ ë£¨í‹´</span>
          <span class="stat-value" th:text="${activeHistories?.size() ?: 0} + 'ê°œ'">0ê°œ</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ìŠ¤í‚µí•œ ë£¨í‹´</span>
          <span class="stat-value" th:text="${passedHistories?.size() ?: 0} + 'ê°œ'">0ê°œ</span>
        </div>
      </div>
    </div>

    <!-- ê³ ì • ë£¨í‹´ ì„¹ì…˜ - ê°€ë¡œ ë°°ì¹˜ (í˜„ì¬ ë‚ ì§œì—ë§Œ í‘œì‹œ) -->
    <div th:unless="${isHistoryView}" class="fixed-routines-section">
      <h3>í•„ìˆ˜ ë£¨í‹´</h3>

      <div class="fixed-routines-container">
        <div class="fixed-routine-card">
          <div class="fixed-routine-content">
            <div class="fixed-routine-info">
              <span class="fixed-routine-title">ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„</span>
              <span class="fixed-routine-description">ì•Œê³ ë¦¬ì¦˜ ë° ì½”ë”©í…ŒìŠ¤íŠ¸ ëŒ€ë¹„</span>
            </div>
          </div>
          <button class="fixed-routine-start-btn" onclick="openCodingTestModal()">ì¶”ê°€í•˜ê¸°</button>
        </div>

        <div class="fixed-routine-card">
          <div class="fixed-routine-content">
            <div class="fixed-routine-info">
              <span class="fixed-routine-title">ë©´ì ‘ ì¤€ë¹„</span>
              <span class="fixed-routine-description">ê¸°ìˆ  ë©´ì ‘ ì§ˆë¬¸ ì—°ìŠµ</span>
            </div>
          </div>
          <button class="fixed-routine-start-btn" onclick="openInterviewModal()">ì¶”ê°€í•˜ê¸°</button>
        </div>
      </div>
    </div>

    <!-- í†µí•©ëœ ë£¨í‹´ ì„¹ì…˜ -->
    <div class="all-routines-section">
      <div class="section-header">
        <h3>ë°ì¼ë¦¬ ë£¨í‹´</h3>
        <button th:unless="${isHistoryView}" class="add-routine-btn" onclick="openModal()">+ ì¶”ê°€</button>
      </div>

      <!-- í™œì„± ë£¨í‹´ ëª©ë¡ -->
      <div th:if="${(activeRoutines != null and !activeRoutines.isEmpty()) or (activeHistories != null and !activeHistories.isEmpty())}">
        <!-- í˜„ì¬ ë£¨í‹´ -->
        <div th:if="${!isHistoryView}" th:each="routine : ${activeRoutines}" class="routine-item">
          <div class="routine-left">
            <div class="routine-info">
              <span class="routine-title" th:text="${routine.title}">ë°ì¼ë¦¬ ë£¨í‹´ 1</span>
              <span class="routine-category" th:text="${routine.category}">ì¹´í…Œê³ ë¦¬</span>
            </div>
          </div>
          <div class="routine-right">
            <button class="routine-btn start" th:data-routine-id="${routine.id}" onclick="navigateToTimer(this)">ì‹œì‘í•˜ê¸°</button>
            <div style="position: relative;">
              <button class="menu-button">â‹¯</button>
              <div class="menu-box">
                <div th:data-routine-id="${routine.id}" onclick="editRoutine(this.dataset.routineId)">ìˆ˜ì •</div>
                <div th:data-routine-id="${routine.id}" onclick="deleteRoutine(this.dataset.routineId)">ì‚­ì œ</div>
                <div th:data-routine-id="${routine.id}" onclick="skipRoutine(this.dataset.routineId)">ì‰¬ì–´ê°€ê¸°</div>
              </div>
            </div>
          </div>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ ë£¨í‹´ -->
        <div th:if="${isHistoryView}" th:each="history : ${activeHistories}" class="routine-item">
          <div class="routine-left">
            <div class="routine-info">
              <span class="routine-title" th:text="${history.title}">ë°ì¼ë¦¬ ë£¨í‹´ 1</span>
              <span class="routine-category" th:text="${history.category}">ì¹´í…Œê³ ë¦¬</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ì‰¬ì–´ê°€ê¸° ë£¨í‹´ ëª©ë¡ -->
      <div th:if="${(passedRoutines != null and !passedRoutines.isEmpty()) or (passedHistories != null and !passedHistories.isEmpty())}">
        <!-- í˜„ì¬ ë£¨í‹´ -->
        <div th:if="${!isHistoryView}" th:each="routine : ${passedRoutines}" class="routine-item passed">
          <div class="routine-left">
            <div class="routine-info">
              <span class="routine-title">
                <span style="color: #888;">(PASS)</span> <span th:text="${routine.title}">ì‰¬ì–´ê°€ê¸° ë£¨í‹´</span>
              </span>
              <span class="routine-category" th:text="${routine.category}">ì¹´í…Œê³ ë¦¬</span>
            </div>
          </div>
          <div class="routine-right">
            <button class="routine-btn passed">ì‰¬ì–´ê°€ê¸°</button>
            <div style="position: relative;">
              <button class="menu-button">â‹¯</button>
              <div class="menu-box">
                <div th:data-routine-id="${routine.id}" onclick="cancelPass(this.dataset.routineId)">ì‰¬ì–´ê°€ê¸° ì·¨ì†Œ</div>
                <div th:data-routine-id="${routine.id}" onclick="deleteRoutine(this.dataset.routineId)">ì‚­ì œ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ ë£¨í‹´ -->
        <div th:if="${isHistoryView}" th:each="history : ${passedHistories}" class="routine-item passed">
          <div class="routine-left">
            <div class="routine-info">
              <span class="routine-title">
                <span style="color: #888;">(PASS)</span> <span th:text="${history.title}">ì‰¬ì–´ê°€ê¸° ë£¨í‹´</span>
              </span>
              <span class="routine-category" th:text="${history.category}">ì¹´í…Œê³ ë¦¬</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ì™„ë£Œëœ ë£¨í‹´ ëª©ë¡ -->
      <div th:if="${(completedRoutines != null and !completedRoutines.isEmpty()) or (completedHistories != null and !completedHistories.isEmpty())}">
        <!-- í˜„ì¬ ë£¨í‹´ -->
        <div th:if="${!isHistoryView}" th:each="routine : ${completedRoutines}" class="routine-item completed">
          <div class="routine-left">
            <div class="routine-info">
              <span class="routine-title" th:text="${routine.title}">ì™„ë£Œëœ ë£¨í‹´ 1</span>
              <span class="routine-category" th:text="${routine.category}">ì¹´í…Œê³ ë¦¬</span>
            </div>
          </div>
          <div class="routine-right">
            <button class="routine-btn completed">ì™„ë£Œ</button>
            <div style="position: relative;">
              <button class="menu-button">â‹¯</button>
              <div class="menu-box">
                <!-- ì½”ë”©í…ŒìŠ¤íŠ¸ ë£¨í‹´ì¸ ê²½ìš° ì •ë³´ë³´ê¸° ì¶”ê°€ -->
                <div th:if="${routine.category != null and #strings.startsWith(routine.category, 'ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„')}"
                     th:data-routine-id="${routine.id}" onclick="viewCodingReview(this.dataset.routineId)">ì •ë³´ë³´ê¸°</div>
                <!-- ë©´ì ‘ì¤€ë¹„ ë£¨í‹´ì¸ ê²½ìš° ì •ë³´ë³´ê¸° ì¶”ê°€ -->
                <div th:if="${routine.category != null and #strings.startsWith(routine.category, 'ë©´ì ‘ì¤€ë¹„')}"
                     th:data-routine-id="${routine.id}" onclick="viewInterviewReview(this.dataset.routineId)">ì •ë³´ë³´ê¸°</div>
                <div th:data-routine-id="${routine.id}" onclick="cancelComplete(this.dataset.routineId)">ì™„ë£Œ ì·¨ì†Œ</div>
                <div th:data-routine-id="${routine.id}" onclick="deleteRoutine(this.dataset.routineId)">ì‚­ì œ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- íˆìŠ¤í† ë¦¬ ë£¨í‹´ -->
        <div th:if="${isHistoryView}" th:each="history : ${completedHistories}" class="routine-item completed">
          <div class="routine-left">
            <div class="routine-info">
              <span class="routine-title" th:text="${history.title}">ì™„ë£Œëœ ë£¨í‹´ 1</span>
              <span class="routine-category" th:text="${history.category}">ì¹´í…Œê³ ë¦¬</span>
            </div>
          </div>
          <div class="routine-right">
            <!-- íˆìŠ¤í† ë¦¬ íšŒê³  ë²„íŠ¼ ì¶”ê°€ -->
            <div th:if="${history.category != null and #strings.startsWith(history.category, 'ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„')}"
                 style="position: relative;">
              <button class="routine-btn history-review"
                      th:data-routine-id="${history.originalRoutineId}"
                      th:data-date="${#temporals.format(selectedDate, 'yyyy-MM-dd')}"
                      onclick="viewHistoryCodingReview(this.dataset.routineId, this.dataset.date)">
                íšŒê³ ë³´ê¸°
              </button>
            </div>
            <div th:if="${history.category != null and #strings.startsWith(history.category, 'ë©´ì ‘ì¤€ë¹„')}"
                 style="position: relative;">
              <button class="routine-btn history-review"
                      th:data-routine-id="${history.originalRoutineId}"
                      th:data-date="${#temporals.format(selectedDate, 'yyyy-MM-dd')}"
                      onclick="viewHistoryInterviewReview(this.dataset.routineId, this.dataset.date)">
                íšŒê³ ë³´ê¸°
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ë£¨í‹´ì´ ì—†ì„ ë•Œ ë³´ì—¬ì¤„ ë¹ˆ ìƒíƒœ -->
      <div th:if="${(activeRoutines == null or activeRoutines.isEmpty()) and (passedRoutines == null or passedRoutines.isEmpty()) and (completedRoutines == null or completedRoutines.isEmpty()) and (activeHistories == null or activeHistories.isEmpty()) and (passedHistories == null or passedHistories.isEmpty()) and (completedHistories == null or completedHistories.isEmpty())}" class="empty-state">
        <p th:if="${isHistoryView}">[[${#temporals.format(selectedDate, 'yyyyë…„ MMì›” ddì¼')}]]ì—ëŠ” ë£¨í‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <p th:unless="${isHistoryView}">ë“±ë¡ëœ ë°ì¼ë¦¬ ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <p th:unless="${isHistoryView}">ì˜¤ëŠ˜ì˜ ë£¨í‹´ì„ ì¶”ê°€í•´ ë³´ì„¸ìš”!</p>
      </div>
    </div>
  </div>
</main>

<!-- ëª¨ë‹¬ ë°°ê²½ -->
<div class="modal-backdrop" id="modalBackdrop"></div>

<!-- ì¼ë°˜ ë£¨í‹´ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
<div id="routineModal">
  <h3>ë£¨í‹´ ì¶”ê°€</h3>
  <form id="routineForm" th:action="@{/routines}" method="post">
    <input type="hidden" id="routineId" name="id" />
    <input type="text" name="category" placeholder="ì¹´í…Œê³ ë¦¬ ì…ë ¥" required />
    <input type="text" name="title" placeholder="ë£¨í‹´ ì œëª©" required />
    <textarea name="description" placeholder="ìƒì„¸ ì„¤ëª…"></textarea>
    <input type="number" name="focusTime" placeholder="ì§‘ì¤‘ ì‹œê°„(ë¶„)" min="1" max="180" required />
    <input type="number" name="breakTime" placeholder="íœ´ì‹ ì‹œê°„(ë¶„)" min="1" max="60" value="5" required />
    <div class="button-group">
      <button type="button" class="cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      <button type="submit" class="submit">ì €ì¥</button>
    </div>
  </form>
</div>

<!-- ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ë£¨í‹´ ëª¨ë‹¬ -->
<div id="codingTestModal">
  <h3>ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ë£¨í‹´ ì¶”ê°€</h3>
  <form id="codingTestForm" th:action="@{/routines}" method="post">

    <input type="text" name="title" placeholder="ë£¨í‹´ ì œëª© (ì˜ˆ: ë°±ì¤€ ì•Œê³ ë¦¬ì¦˜ í’€ì´)" required />
    <select name="problemType" required>
      <option value="">ë¬¸ì œ ì¢…ë¥˜ ì„ íƒ</option>
      <option value="ìë£Œêµ¬ì¡°">ìë£Œêµ¬ì¡°</option>
      <option value="BFS/DFS">BFS/DFS</option>
      <option value="êµ¬í˜„">êµ¬í˜„</option>
      <option value="ë‹¤ìµìŠ¤íŠ¸ë¼">ë‹¤ìµìŠ¤íŠ¸ë¼</option>
      <option value="íŠ¸ë¦¬">íŠ¸ë¦¬</option>
      <option value="ë‹¤ì´ë‚˜ë¯¹ í”„ë¡œê·¸ë˜ë°">ë‹¤ì´ë‚˜ë¯¹ í”„ë¡œê·¸ë˜ë°</option>
      <option value="íƒìƒ‰">íƒìƒ‰</option>
      <option value="ê·¸ë¦¬ë””">ê·¸ë¦¬ë””</option>
      <option value="ê¸°íƒ€">ê¸°íƒ€</option>
    </select>
    <textarea name="description" placeholder="ìƒì„¸ ì„¤ëª…"></textarea>
    <input type="number" name="focusTime" placeholder="ì§‘ì¤‘ ì‹œê°„(ë¶„)" min="1" max="180" required />
    <input type="number" name="breakTime" placeholder="íœ´ì‹ ì‹œê°„(ë¶„)" min="1" max="60" value="5" required />
    <input type="hidden" name="category" id="codingTestCategory" />
    <div class="button-group">
      <button type="button" class="cancel" onclick="closeCodingTestModal()">ì·¨ì†Œ</button>
      <button type="submit" class="submit">ì €ì¥</button>
    </div>
  </form>
</div>

<!-- ë©´ì ‘ ì¤€ë¹„ ë£¨í‹´ ëª¨ë‹¬ -->
<div id="interviewModal">
  <h3>ë©´ì ‘ ì¤€ë¹„ ë£¨í‹´ ì¶”ê°€</h3>
  <form id="interviewForm" th:action="@{/routines}" method="post">

    <input type="text" name="title" placeholder="ë£¨í‹´ ì œëª© ì…ë ¥ (ì˜ˆ: Java ê¸°ì´ˆ ê°œë… ì •ë¦¬)" required />

    <select name="techType" required>
      <option value="">ê¸°ìˆ  ì¢…ë¥˜ ì„ íƒ</option>
      <option value="ì•Œê³ ë¦¬ì¦˜">ì•Œê³ ë¦¬ì¦˜</option>
      <option value="ìë£Œêµ¬ì¡°">ìë£Œêµ¬ì¡°</option>
      <option value="ë°ì´í„°ë² ì´ìŠ¤">ë°ì´í„°ë² ì´ìŠ¤</option>
      <option value="ìš´ì˜ì²´ì œ">ìš´ì˜ì²´ì œ</option>
      <option value="ë„¤íŠ¸ì›Œí¬">ë„¤íŠ¸ì›Œí¬</option>
      <option value="ì»´í“¨í„°êµ¬ì¡°">ì»´í“¨í„°êµ¬ì¡°</option>
    </select>

    <textarea name="description" placeholder="ìƒì„¸ ì„¤ëª… (ì„ íƒì‚¬í•­)"></textarea>
    <input type="number" name="focusTime" placeholder="ì§‘ì¤‘ ì‹œê°„(ë¶„)" min="1" max="180"  required />
    <input type="number" name="breakTime" placeholder="íœ´ì‹ ì‹œê°„(ë¶„)" min="1" max="60" value="5" required />

    <input type="hidden" name="category" id="interviewCategory" />

    <div class="button-group">
      <button type="button" class="cancel" onclick="closeInterviewModal()">ì·¨ì†Œ</button>
      <button type="submit" class="submit">ì €ì¥</button>
    </div>
  </form>
</div>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    // âœ… ìˆ˜ì •ëœ ë©”ë‰´ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì •
    const menuButtons = document.querySelectorAll('.menu-button');
    menuButtons.forEach(btn => {
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        const menuBox = this.nextElementSibling;

        // ë‹¤ë¥¸ ì—´ë¦° ë©”ë‰´ ë‹«ê¸°
        document.querySelectorAll('.menu-box').forEach(box => {
          if (box !== menuBox) {
            box.classList.remove('show');
            // ì• ë‹ˆë©”ì´ì…˜ í›„ display none
            setTimeout(() => {
              if (!box.classList.contains('show')) {
                box.style.display = 'none';
              }
            }, 200);
          }
        });

        // í˜„ì¬ ë©”ë‰´ í† ê¸€
        if (menuBox.classList.contains('show')) {
          // ë©”ë‰´ ë‹«ê¸°
          menuBox.classList.remove('show');
          setTimeout(() => {
            if (!menuBox.classList.contains('show')) {
              menuBox.style.display = 'none';
            }
          }, 200);
        } else {
          // ë©”ë‰´ ì—´ê¸°
          menuBox.style.display = 'block';
          // ë‹¤ìŒ í”„ë ˆì„ì—ì„œ show í´ë˜ìŠ¤ ì¶”ê°€ (ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´)
          requestAnimationFrame(() => {
            menuBox.classList.add('show');
          });
        }
      });
    });

    // ë¬¸ì„œ í´ë¦­ ì‹œ ì—´ë¦° ë©”ë‰´ ë‹«ê¸°
    document.addEventListener('click', function() {
      document.querySelectorAll('.menu-box').forEach(box => {
        box.classList.remove('show');
        setTimeout(() => {
          if (!box.classList.contains('show')) {
            box.style.display = 'none';
          }
        }, 200);
      });
    });
  });

  // ëª¨ë‹¬ ë°°ê²½ ìš”ì†Œ
  const modalBackdrop = document.getElementById('modalBackdrop');

  function openModal() {
    // í¼ ì´ˆê¸°í™”
    document.getElementById('routineForm').reset();
    document.getElementById('routineId').value = '';
    document.getElementById('routineModal').style.display = 'block';
    modalBackdrop.style.display = 'block';
  }

  function closeModal() {
    document.getElementById('routineModal').style.display = 'none';
    modalBackdrop.style.display = 'none';
  }

  function openCodingTestModal() {
    document.getElementById('codingTestForm').reset();
    document.getElementById('codingTestModal').style.display = 'block';
    modalBackdrop.style.display = 'block';
  }

  function closeCodingTestModal() {
    document.getElementById('codingTestModal').style.display = 'none';
    modalBackdrop.style.display = 'none';
  }

  function openInterviewModal() {
    document.getElementById('interviewForm').reset();
    document.getElementById('interviewModal').style.display = 'block';
    modalBackdrop.style.display = 'block';
  }

  function closeInterviewModal() {
    document.getElementById('interviewModal').style.display = 'none';
    modalBackdrop.style.display = 'none';
  }

  // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
  modalBackdrop.addEventListener('click', function() {
    closeModal();
    closeCodingTestModal();
    closeInterviewModal();
  });

  // ì½”ë”©í…ŒìŠ¤íŠ¸ í¼ ì œì¶œ ì‹œ
  document.getElementById('codingTestForm').addEventListener('submit', function(e) {
    const problemType = document.querySelector('select[name="problemType"]').value;
    if (problemType) {
      document.getElementById('codingTestCategory').value = `ì½”ë”©í…ŒìŠ¤íŠ¸ ì¤€ë¹„ - ${problemType}`;
    }
  });

  // ë©´ì ‘ì¤€ë¹„ í¼ ì œì¶œ ì‹œ
  document.getElementById('interviewForm').addEventListener('submit', function(e) {
    const techType = document.querySelector('select[name="techType"]').value;
    if (techType) {
      document.getElementById('interviewCategory').value = `ë©´ì ‘ì¤€ë¹„ - ${techType}`;
    }
  });

  // íƒ€ì´ë¨¸ë¡œ ì´ë™ í•¨ìˆ˜
  function navigateToTimer(element) {
    const routineId = element.dataset.routineId;
    location.href = '/routines/' + routineId + '/timer';
  }

  // ì½”ë”©í…ŒìŠ¤íŠ¸ íšŒê³  ì •ë³´ë³´ê¸°
  function viewCodingReview(routineId) {
    location.href = '/routines/' + routineId + '/coding-review';
  }

  // ë©´ì ‘ì¤€ë¹„ íšŒê³  ì •ë³´ë³´ê¸°
  function viewInterviewReview(routineId) {
    location.href = '/routines/' + routineId + '/interview-review';
  }

  function editRoutine(routineId) {
    fetch(`/routines/${routineId}/edit`)
    .then(response => response.json())
    .then(data => {
      // ëª¨ë‹¬ ì œëª© ë³€ê²½
      document.querySelector('#routineModal h3').textContent = 'ë£¨í‹´ ìˆ˜ì •';

      // í¼ ë°ì´í„° ì±„ìš°ê¸°
      document.getElementById('routineId').value = data.id;
      document.querySelector('input[name="category"]').value = data.category || '';
      document.querySelector('input[name="title"]').value = data.title || '';
      document.querySelector('textarea[name="description"]').value = data.description || '';
      document.querySelector('input[name="focusTime"]').value = data.focusTime || '';
      document.querySelector('input[name="breakTime"]').value = data.breakTime || 5;

      // í¼ ì•¡ì…˜ ë° ë©”ì„œë“œ ë³€ê²½
      const form = document.getElementById('routineForm');
      form.action = `/routines/${routineId}`;

      // CSRF í† í° ì¶”ê°€
      const csrfToken = document.querySelector('meta[name="_csrf"]').content;
      let csrfInput = form.querySelector('input[name="_csrf"]');
      if (!csrfInput) {
        csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = '_csrf';
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
      } else {
        csrfInput.value = csrfToken;
      }

      // hidden input ì¶”ê°€
      let methodInput = document.createElement('input');
      methodInput.type = 'hidden';
      methodInput.name = '_method';
      methodInput.value = 'PATCH';
      form.appendChild(methodInput);

      // ëª¨ë‹¬ í‘œì‹œ
      document.getElementById('routineModal').style.display = 'block';
      modalBackdrop.style.display = 'block';
    })
    .catch(error => {
      console.error('Error:', error);
      alert('ë£¨í‹´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    });
  }

  function deleteRoutine(routineId) {
    if (confirm('ì •ë§ ì´ ë£¨í‹´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      // CSRF í† í° ê°€ì ¸ì˜¤ê¸°
      const csrfToken = document.querySelector('meta[name="_csrf"]').content;
      const csrfHeader = document.querySelector('meta[name="_csrf_header"]').content;

      fetch(`/routines/${routineId}`, {
        method: 'DELETE',
        headers: {
          [csrfHeader]: csrfToken
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // ì„±ê³µ ì‹œ í•´ë‹¹ ìš”ì†Œë§Œ DOMì—ì„œ ì œê±°
          const routineElement = document.querySelector(`[data-routine-id="${routineId}"]`).closest('.routine-item');
          if (routineElement) {
            routineElement.remove();
            showNotification(data.message);
            checkEmptySections();
          } else {
            window.location.reload();
          }
        } else {
          alert(data.message || 'ë£¨í‹´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('ë£¨í‹´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      });
    }
  }

  function skipRoutine(routineId) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/routines/${routineId}/skip`;

    const methodInput = document.createElement('input');
    methodInput.type = 'hidden';
    methodInput.name = '_method';
    methodInput.value = 'PATCH';
    form.appendChild(methodInput);

    const csrfToken = document.querySelector('meta[name="_csrf"]').content;
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = '_csrf';
    csrfInput.value = csrfToken;
    form.appendChild(csrfInput);

    document.body.appendChild(form);
    form.submit();
  }

  function cancelPass(routineId) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/routines/${routineId}/cancel`;

    const methodInput = document.createElement('input');
    methodInput.type = 'hidden';
    methodInput.name = '_method';
    methodInput.value = 'PATCH';
    form.appendChild(methodInput);

    const csrfToken = document.querySelector('meta[name="_csrf"]').content;
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = '_csrf';
    csrfInput.value = csrfToken;
    form.appendChild(csrfInput);

    document.body.appendChild(form);
    form.submit();
  }

  function cancelComplete(routineId) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/routines/${routineId}/cancel`;

    const methodInput = document.createElement('input');
    methodInput.type = 'hidden';
    methodInput.name = '_method';
    methodInput.value = 'PATCH';
    form.appendChild(methodInput);

    const csrfToken = document.querySelector('meta[name="_csrf"]').content;
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = '_csrf';
    csrfInput.value = csrfToken;
    form.appendChild(csrfInput);

    document.body.appendChild(form);
    form.submit();
  }

  function showNotification(message) {
    // ì•Œë¦¼ í‘œì‹œ ë¡œì§
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    background-color: #10b981;
    color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 9999;
    animation: slideIn 0.3s ease-out;
  `;

    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.opacity = '0';
      notification.style.transition = 'opacity 0.5s';
      setTimeout(() => notification.remove(), 500);
    }, 3000);
  }

  function checkEmptySections() {
    const allRoutines = document.querySelectorAll('.all-routines-section .routine-item');
    const emptyStateExists = document.querySelector('.empty-state');

    if (allRoutines.length === 0 && !emptyStateExists) {
      const emptyState = document.createElement('div');
      emptyState.className = 'empty-state';
      emptyState.innerHTML = '<p>ë“±ë¡ëœ ë°ì¼ë¦¬ ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤.</p><p>ì˜¤ëŠ˜ì˜ ë£¨í‹´ì„ ì¶”ê°€í•´ ë³´ì„¸ìš”!</p>';

      const allRoutinesSection = document.querySelector('.all-routines-section');
      allRoutinesSection.appendChild(emptyState);
    }
  }

  // íˆìŠ¤í† ë¦¬ ì½”ë”©í…ŒìŠ¤íŠ¸ íšŒê³  ë³´ê¸°
  function viewHistoryCodingReview(routineId, date) {
    location.href = '/routines/history/' + routineId + '/coding-review?date=' + date;
  }

  // íˆìŠ¤í† ë¦¬ ë©´ì ‘ì¤€ë¹„ íšŒê³  ë³´ê¸°
  function viewHistoryInterviewReview(routineId, date) {
    location.href = '/routines/history/' + routineId + '/interview-review?date=' + date;
  }
</script>

<th:block th:replace="fragments/common/chatbot-modal :: chatbot"></th:block>
</body>
</html>