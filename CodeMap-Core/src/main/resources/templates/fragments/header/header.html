<!-- âœ… PC ì „ìš© í—¤ë” Fragment -->
<div th:fragment="header" class="header">
  <!-- í—¤ë” ë°°ê²½ íš¨ê³¼ -->
  <div class="header-background">
    <div class="header-blur-overlay"></div>
    <div class="header-gradient-overlay"></div>
  </div>

  <!-- ì¢Œì¸¡ ë¡œê³  ì˜ì—­ -->
  <div class="header-logo">
    <a th:href="${#authorization.expression('hasRole(''ROLE_ADMIN'')')} ? @{/admin/users} : @{/user/main}" class="logo-link">
      <div class="logo-icon">
        <div class="logo-gradient">
          <span class="logo-emoji">ğŸ“Š</span>
          <div class="logo-shine"></div>
        </div>
        <div class="logo-ring"></div>
      </div>
      <div class="logo-text-wrapper">
        <span class="logo-text">CodeMap</span>
        <div class="logo-subtitle">Developer Journey</div>
      </div>
    </a>
  </div>

  <!-- ì¤‘ì•™ ë¹ˆ ê³µê°„ -->
  <div class="header-center"></div>

  <!-- ìš°ì¸¡ ì‚¬ìš©ì ì •ë³´ ì˜ì—­ -->
  <div class="header-actions">
    <!-- í…Œë§ˆ í† ê¸€ ë²„íŠ¼ -->
    <div class="theme-toggle-wrapper">
      <button id="theme-toggle" class="action-btn theme-toggle-btn" title="í…Œë§ˆ ë³€ê²½">
        <div class="btn-content">
          <div class="btn-icon theme-icon">
            <span class="light-icon">â˜€ï¸</span>
            <span class="dark-icon">ğŸŒ™</span>
          </div>
        </div>
        <div class="btn-hover-effect theme-effect"></div>
      </button>
    </div>

    <!-- ì•Œë¦¼ ì•„ì´ì½˜ -->
    <div class="notification-wrapper">
      <span id="notification-icon">ğŸ””</span>
      <div id="notification-popup"></div>
    </div>

    <!-- ì‚¬ìš©ì ì •ë³´ -->
    <div class="user-info">
      <div class="user-avatar-wrapper">
        <div class="user-avatar" th:text="${user != null ? #strings.substring(user.nickname, 0, 1) : 'U'}">U</div>
        <div class="avatar-glow"></div>
        <div class="status-indicator"></div>
      </div>
      <div class="user-details">
        <span class="user-name" th:text="${user != null ? user.nickname : 'ì‚¬ìš©ì'}">ì‚¬ìš©ì</span>
        <div class="user-status">
          <div class="status-dot"></div>
          <span>ì˜¨ë¼ì¸</span>
        </div>
      </div>
    </div>

    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <form th:action="@{/user/logout}" method="post" class="logout-form">
      <button type="submit" class="action-btn logout-btn">
        <div class="btn-content">
          <div class="btn-icon">ğŸšª</div>
          <span class="btn-text">ë¡œê·¸ì•„ì›ƒ</span>
        </div>
        <div class="btn-hover-effect logout-effect"></div>
      </button>
    </form>
  </div>
  <script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function() {
      // âœ… í…Œë§ˆ ì´ˆê¸°í™” ë° ì ìš©
      function initializeTheme() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.body.classList.remove('light-theme', 'dark-theme');
        document.body.classList.add(savedTheme + '-theme');
        updateThemeToggleIcon(savedTheme);
      }

      // âœ… í…Œë§ˆ í† ê¸€ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
      function updateThemeToggleIcon(theme) {
        const lightIcon = document.querySelector('.light-icon');
        const darkIcon = document.querySelector('.dark-icon');

        if (theme === 'dark') {
          if (lightIcon) lightIcon.style.display = 'block';
          if (darkIcon) darkIcon.style.display = 'none';
        } else {
          if (lightIcon) lightIcon.style.display = 'none';
          if (darkIcon) darkIcon.style.display = 'block';
        }
      }

      // âœ… í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥
      function toggleTheme() {
        const currentTheme = localStorage.getItem('theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';

        // localStorageì— ì €ì¥
        localStorage.setItem('theme', newTheme);

        // body í´ë˜ìŠ¤ ë³€ê²½ (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼)
        document.body.classList.add('theme-transition');
        document.body.classList.remove('light-theme', 'dark-theme');
        document.body.classList.add(newTheme + '-theme');

        // ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
        updateThemeToggleIcon(newTheme);

        // ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ í´ë˜ìŠ¤ ì œê±°
        setTimeout(() => {
          document.body.classList.remove('theme-transition');
        }, 300);
      }

      // âœ… í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      const themeToggleBtn = document.getElementById('theme-toggle');
      if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', toggleTheme);
      }

      // âœ… ì´ˆê¸° í…Œë§ˆ ì ìš©
      initializeTheme();

      // í—¤ë” ê³ ì •
      const header = document.querySelector('.header');
      if (header) {
        header.style.position = 'fixed';
        header.style.top = '0';
        header.style.left = '0';
        header.style.right = '0';
        header.style.zIndex = '9999';
        header.style.width = '100%';
      }

      // ìŠ¤í¬ë¡¤ íš¨ê³¼
      let lastScrollY = window.scrollY;
      let ticking = false;

      function updateHeader() {
        const currentScrollY = window.scrollY;
        const header = document.querySelector('.header');

        if (header) {
          if (currentScrollY > 50) {
            header.classList.add('scrolled');
          } else {
            header.classList.remove('scrolled');
          }
        }

        lastScrollY = currentScrollY;
        ticking = false;
      }

      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(updateHeader);
          ticking = true;
        }
      });
    });
    /*]]>*/
  </script>
</div>

<!-- âœ… ì•Œë¦¼ ìŠ¤í¬ë¦½íŠ¸ ì—°ê²° -->
<th:block th:replace="~{fragments/common/alert-script :: alert-script}" />